<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>Quick Chat</title>
<meta http-equiv="Content-Security-Policy"
content="default-src 'self' data: blob:;
                 img-src 'self' data: blob:;
                 style-src 'self' 'unsafe-inline';
                 script-src 'self';
                 connect-src 'self' http://127.0.0.1:* http://localhost:* https://127.0.0.1:*;">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
:root {
--pad: 10px; --radius: 12px;
--bg: #0e1217; --fg: #e7eaf0; --bubble-user: #1a2230; --bubble-assistant: #121823; --hint: #8a93a3;
--chrome: #0b0f14; --border:#1b2330;
    }
html, body { height: 100%; }
body {
margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
background: var(--bg); color: var(--fg);
    }
.dragbar {
height: 24px; background: var(--chrome);
-webkit-app-region: drag; border-top-left-radius: 12px; border-top-right-radius: 12px;
border-bottom: 1px solid var(--border);
    }
.wrap { height: calc(100vh - 24px); display:flex; flex-direction:column; gap:8px; padding:var(--pad); box-sizing:border-box; }
.topbar { display:flex; gap:8px; align-items:center; }
input, button, datalist {
border-radius:10px; border:1px solid rgba(255,255,255,.06); padding:8px;
font-size:14px; outline:none; background:#0f1622; color: var(--fg);
-webkit-app-region: no-drag;
    }
button { cursor: pointer; }
.row { display:flex; gap:8px; }
.row input[type="text"] { flex:1; }
.msgs { flex:1; overflow:auto; display:flex; flex-direction:column; gap:6px; }
.msg { padding:8px; border-radius:8px; white-space:pre-wrap; }
.u { background: var(--bubble-user); align-self:flex-end; }
.a { background: var(--bubble-assistant); align-self:flex-start; }
.hint { font-size:12px; color: var(--hint); }
.error { font-size:12px; color:#ff6b6b; white-space:pre-wrap; }
/* Typing indicator: tre puntini che saltellano */
.typing { display:inline-flex; gap:4px; align-items:center; }
.dot { width:6px; height:6px; background:#77809a; border-radius:50%; display:inline-block; animation: bounce 1s infinite ease-in-out; }
.dot:nth-child(2) { animation-delay: .15s; }
.dot:nth-child(3) { animation-delay: .3s; }
@keyframes bounce { 0%, 80%, 100% { transform: translateY(0); opacity:.6; } 40% { transform: translateY(-5px); opacity:1; } }
/* Modal setup API key */
.modal {
position: fixed; inset: 24px; display: none; z-index: 10;
background: rgba(14,18,23,0.95); border:1px solid var(--border); border-radius:12px;
padding:16px; box-sizing:border-box;
    }
.modal.show { display:block; }
.modal h3 { margin:0 0 8px 0; font-size:16px; }
.modal p, .modal ol { margin:6px 0; color: var(--hint); font-size:13px; }
.modal .row { margin-top:8px; }
/* —– Thinking collapsible —– */
details.thinking {
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 6px 8px;
  margin: 8px 0;
  background: var(--bubble-assistant);
}
details.thinking summary {
  list-style: none;
  cursor: pointer;
  font-weight: bold;
  position: relative;
  padding-right: 20px;
}
details.thinking summary::-webkit-details-marker { display: none; }
details.thinking summary:after {
  content: "▼";
  position: absolute;
  right: 0;
  top: 0;
}
details.thinking[open] summary:after {
  content: "▲";
}
details.thinking pre {
  margin: 4px 0 0;
  background: transparent;
  padding: 0;
}
/* —– Code blocks with sticky copy button —– */
.code-block {
  margin: 8px 0;
}
.code-block pre {
  background: #1e1e1e;
  color: #dcdcdc;
  padding: 8px;
  border-radius: 6px;
  overflow: auto;
}
.copy-btn {
  position: sticky;
  top: 0;
  float: right;
  margin-bottom: 4px;
  background: var(--bg);
  color: var(--fg);
  border: 1px solid var(--border);
  padding: 4px 8px;
  font-size: 12px;
  border-radius: 4px;
  cursor: pointer;
  z-index: 2;
}
.copy-btn:hover {
  background: var(--bubble-user);
}
</style>
</head>
<body>
<div class="dragbar"></div>
<div class="wrap">
<div class="topbar">
<button id="newChat" title="New chat">New</button>
<input id="modelInput" list="models" placeholder="model (e.g. llama3:8b)" />
<datalist id="models"></datalist>
<button id="refresh" title="Reload models">↻</button>
<button id="keyBtn" title="Set/Change API key">Key</button>
<span id="status" class="hint"></span>
</div>
<div id="msgs" class="msgs"></div>
<div class="row">
<input id="prompt" type="text" placeholder="Type a message…" />
<button id="send">Send</button>
</div>
<div id="err" class="error"></div>
</div>
<!-- Modal: first-run / change API key -->
<div id="setup" class="modal">
<h3>API Key required</h3>
<p>This popup uses the OpenAI-compatible API of your Open WebUI.</p>
<ol>
<li>Open your Open WebUI.</li>
<li>Go to <strong>Settings → Account</strong> (English UI).</li>
<li>Click <strong>Create API Key</strong> and copy it.</li>
</ol>
<div class="row">
<input id="apiKeyInput" type="password" placeholder="Paste API key here" style="flex:1;" />
<button id="saveKey">Save</button>
<button id="cancelKey">Cancel</button>
</div>
<p class="hint">You can change this later with the <em>Key</em> button.</p>
</div>
<script src="./app.js"></script>
</body>
</html>